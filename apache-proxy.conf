# MAS API Proxy Configuration
# This configuration allows Apache to proxy requests to the Node.js backend

# Enable necessary modules:
# sudo a2enmod proxy
# sudo a2enmod proxy_http
# sudo a2enmod headers

<VirtualHost *:80>
    # Adjust ServerName as needed
    # ServerName your-domain.com

    # Static documentation files
    Alias /mas-api /var/www/mas/api-docs

    <Directory /var/www/mas/api-docs>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted

        # YAML files MIME type
        <FilesMatch "\.yaml$">
            ForceType text/yaml
        </FilesMatch>

        DirectoryIndex landing.html index.html
    </Directory>

    # Proxy API requests to Node.js backend
    ProxyPreserveHost On

    # API endpoints
    <Location /api/message>
        ProxyPass http://localhost:8765/message
        ProxyPassReverse http://localhost:8765/message
    </Location>

    <Location /api/runs>
        ProxyPass http://localhost:8765/runs
        ProxyPassReverse http://localhost:8765/runs
    </Location>

    # CORS headers for API
    <LocationMatch "^/api/">
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type"
    </LocationMatch>

    # Error log
    ErrorLog ${APACHE_LOG_DIR}/mas-api-error.log
    CustomLog ${APACHE_LOG_DIR}/mas-api-access.log combined
</VirtualHost>