# Simplify Workspace Structure

## Summary
MASの作業ディレクトリ構造を簡素化し、`mas init`を実行したディレクトリをワークスペースルートとして直接使用するように変更する。`.mas`プレフィックスを削除し、より直感的なディレクトリ構造を実現する。

## Problem
現在のMASアーキテクチャには以下の問題がある：

1. **複雑な階層構造**: `~/.mas/sessions/{uuid}/`という深いディレクトリ階層
2. **非直感的なプレフィックス**: `.mas`という隠しディレクトリプレフィックスがわかりづらい
3. **分散した設定**: プロジェクトレベルの`.mas/config.json`と`~/.mas`の設定が分散
4. **ユーザー指定の作業ディレクトリ無視**: `mas init`を実行した場所に関係なく`~/.mas`配下で作業
5. **ポータビリティの欠如**: プロジェクトを別環境に移動した際の依存関係

これらの問題により、ユーザーは自分の作業がどこで行われているか把握しづらく、プロジェクト管理が複雑になっている。

## Solution
`mas init`を実行したディレクトリを直接ワークスペースとして使用し、シンプルな構造を実現する：

### 新しいディレクトリ構造
```
project-dir/                    # mas init実行ディレクトリ
├── api.log                    # APIログ（旧 ~/.mas/api.log）
├── api.pid                    # APIプロセスID
├── config.json                # プロジェクト設定（旧 .mas/config.json）
├── logs/                      # ログディレクトリ
├── sessions/                  # セッション管理（旧 ~/.mas/sessions）
│   ├── .index                # セッションインデックス
│   └── {session-uuid}/       # 各セッションディレクトリ
│       ├── metadata.json     # セッションメタデータ
│       ├── unit/             # セッション専用ユニット
│       └── workflows/        # セッション専用ワークフロー
├── templates/                 # テンプレートライブラリ
├── unit/                      # ユニットテンプレート
├── web.log                    # Webログ
├── web.pid                    # Webプロセス ID
├── workflows/                 # ワークフローテンプレート
└── .masrc                     # プロジェクトマーカー（後方互換性）
```

### 主要な変更点
1. **直接初期化**: `mas init`実行ディレクトリをワークスペースルートとして使用
2. **プレフィックス削除**: `.mas`ディレクトリを廃止し、フラットな構造に
3. **統合された設定**: すべての設定とデータを1箇所に集約
4. **可視性向上**: 隠しディレクトリを避け、すべてを可視化
5. **ポータブル**: プロジェクトディレクトリごと移動可能

### 環境変数の変更
- `MAS_DATA_DIR`: 削除（不要になる）
- `MAS_WORKSPACE_ROOT`: 新規追加（現在の作業ディレクトリ）
- `MAS_PROJECT_ROOT`: プロジェクトルートディレクトリ

## Outcomes
- **シンプルさ**: ディレクトリ構造が直感的で理解しやすい
- **透明性**: すべてのファイルとディレクトリが見える
- **ポータビリティ**: プロジェクト全体を簡単に移動・共有可能
- **開発効率**: 作業ディレクトリが明確で管理しやすい
- **後方互換性**: `.masrc`ファイルによる既存プロジェクト検出維持

## Scope
### In Scope
- `mas-core.sh`の`cmd_init()`関数の更新
- `lib/project.sh`のディレクトリ構造管理の更新
- `lib/mas-session.sh`のセッションワークスペース作成の更新
- `scripts/start_session.sh`の作業ディレクトリ参照の更新
- 環境変数の整理と更新
- APIとWebサーバーのログ・PIDファイル配置変更

### Out of Scope
- npmパッケージのグローバルインストール構造の変更
- tmuxセッション管理ロジックの変更
- エージェント初期化（OpenSpec）の変更
- HTTPサーバーのポート管理
- バージョン管理システムとの統合

## Constraints
- 既存の`.masrc`ファイルを持つプロジェクトとの後方互換性を維持
- セッションUUIDベースの管理は維持
- tmuxセッション名のフォーマット（mas-XXXXXXXX）は維持
- 既存のAPIエンドポイント仕様は変更しない