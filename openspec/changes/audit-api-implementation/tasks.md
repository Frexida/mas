# タスクリスト: API実装と仕様の不整合解消

## Phase 1: 緊急修正（動作可能な最小限の実装）

### 1. `/runs` エンドポイントの修正
- [x] `mas_refactored.sh` に `--config` オプションを追加
- [x] 設定ファイルからのエージェント構成読み込み実装（簡易版）
- [x] または、直接エージェントを起動する新しいアプローチの実装
- [x] セッションID生成をUUID形式に変更

### 2. レスポンススキーマの統一
- [x] MessageResponseの`status`フィールドを仕様に合わせる（"acknowledged"に変更）
- [x] RunResponseの形式を仕様と一致させる
- [ ] エラーレスポンスの形式を統一

### 3. バリデーション修正
- [x] Agent IDのバリデーションパターンを統一（^[0-9]{2}$に変更）
- [x] Unit数の制限を仕様と一致させる（最大4ユニットに変更）

## Phase 2: 品質改善

### 4. 文書化とテスト
- [ ] `/status` エンドポイントをOpenAPI仕様に追加
- [ ] `/health` エンドポイントを仕様に追加
- [ ] 各エンドポイントの統合テスト作成
- [ ] エラーケースのテスト追加

### 5. エラーハンドリング
- [ ] 詳細なエラーメッセージの実装
- [ ] エラーコードの体系化
- [ ] ログ出力の改善

### 6. 状態管理
- [ ] セッション状態の正確な追跡
- [ ] エージェント起動確認の実装
- [ ] タイムアウト処理の追加

## Phase 3: 完全実装

### 7. 高度な機能
- [ ] WebSocketによるリアルタイム更新
- [ ] セッション管理API（停止、再開、削除）
- [ ] ログストリーミング

### 8. セキュリティと運用
- [ ] API認証の実装
- [ ] レート制限
- [ ] メトリクス収集
- [ ] ヘルスチェックの高度化

## 検証項目

### 動作確認
- [ ] Swagger UIからすべてのエンドポイントが呼び出し可能
- [ ] MAS UIからエージェント起動が成功
- [ ] エラーケースが適切にハンドリングされる

### 仕様準拠
- [ ] OpenAPI仕様のすべてのエンドポイントが実装済み
- [ ] レスポンス形式が仕様と完全一致
- [ ] バリデーションルールが仕様通り

### 品質基準
- [ ] エラー率が1%未満
- [ ] レスポンスタイムが1秒以内
- [ ] 同時接続数10以上のサポート