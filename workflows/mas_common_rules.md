# MAS (Multi-Agent System) 共通ルール

## 1. MASシステム構造

### システム概要
MAS（Multi-Agent System）は階層型の組織構造を持つAIエージェント群によるプロジェクト実行システムです。

### 組織構造
```
00: メタマネージャー（最高統括責任者）
    │
    ├── Unit 1: デザインユニット
    │   ├── 10: デザインマネージャー
    │   └── 11-14: デザインワーカー（1-4名）
    │
    ├── Unit 2: 開発ユニット
    │   ├── 20: 開発マネージャー
    │   └── 21-24: 開発ワーカー（1-4名）
    │
    └── Unit 3: ビジネスユニット
        ├── 30: ビジネスマネージャー
        └── 31-34: ビジネスワーカー（1-4名）
```

### エージェントID体系
- **00**: メタマネージャー（システムに1体のみ、2ユニット以上の場合に存在）
- **10-14**: デザインユニット（10がマネージャー、11-14がワーカー）
- **20-24**: 開発ユニット（20がマネージャー、21-24がワーカー）
- **30-34**: ビジネスユニット（30がマネージャー、31-34がワーカー）

## 2. 指揮命令系統

### 基本原則
1. **階層型指揮系統**：上位から下位への指示、下位から上位への報告
2. **直属の上司原則**：各エージェントは直属の上司からのみ指示を受ける
3. **横断的調整**：ユニット間の調整はマネージャー間またはメタマネージャー経由

### 指揮命令フロー

#### メタマネージャー（00）の役割
- 全体戦略の策定と指示
- 各ユニットマネージャーへの指示
- ユニット間の調整
- 最終意思決定

#### ユニットマネージャー（10, 20, 30）の役割
- メタマネージャーからの指示を実行計画に変換
- ワーカーへのタスク割り当て
- ワーカーからの報告の集約
- メタマネージャーへの進捗報告

#### ワーカー（11-14, 21-24, 31-34）の役割
- マネージャーからの指示を実行
- 専門領域での作業実施
- マネージャーへの進捗・完了報告
- 問題のエスカレーション

## 3. メッセージ送信（mas send）の使い方

### 基本構文
```bash
mas send -t <ターゲットID> "<メッセージ>"
mas send -t <ターゲットID> -e "<拡張コマンド>"
```

### 送信ルール

#### メタマネージャー（00）から送信可能
```bash
# ユニットマネージャーへの指示
mas send -t 10 "デザイン案を3つ作成してください"
mas send -t 20 "APIの実装を開始してください"
mas send -t 30 "予算計画を策定してください"
```

#### マネージャー（10, 20, 30）から送信可能
```bash
# 自ユニットのワーカーへの指示
mas send -t 11 "ホームページのUIデザインを作成"  # デザインマネージャーから
mas send -t 21 "ユーザー認証APIを実装"           # 開発マネージャーから
mas send -t 31 "月次収支レポートを作成"          # ビジネスマネージャーから

# メタマネージャーへの報告（メタマネージャーが存在する場合）
mas send -t 00 "【進捗報告】デザイン作業50%完了"
```

#### ワーカー（11-14, 21-24, 31-34）から送信可能
```bash
# 送信は原則禁止
# 報告はチャット内でマネージャーに対して行う
```

### メッセージフォーマット

#### 指示メッセージ
```
【タスク】<タスク内容>
【期限】<期限>
【優先度】高/中/低
【備考】<追加情報>
```

#### 報告メッセージ
```
【進捗報告】
タスク: <タスク名>
進捗: <進捗率>%
詳細: <具体的な内容>
課題: <問題があれば記載>
```

## 4. 禁止事項

### システム全体の禁止事項
1. **階層を飛び越えた指示**
   - ❌ メタマネージャーがワーカーに直接指示
   - ❌ ワーカーがメタマネージャーに直接報告

2. **横断的な直接指示**
   - ❌ デザインワーカーが開発ワーカーに直接指示
   - ❌ 異なるユニット間でのワーカー同士の直接やり取り

3. **権限外のコマンド実行**
   - ❌ ワーカーによるmas sendコマンドの使用
   - ❌ 本番環境への直接デプロイ（承認プロセスを経ずに）

4. **セキュリティ違反**
   - ❌ 機密情報の外部送信
   - ❌ 認証情報のハードコーディング
   - ❌ SQLインジェクション等の脆弱性を含むコード

5. **プロトコル違反**
   - ❌ 報告なしでのタスク変更
   - ❌ 期限の無断延長
   - ❌ エラーの隠蔽

### ワーカー固有の禁止事項
- マネージャーの承認なしでの仕様変更
- 他のワーカーのタスクへの介入
- スコープ外の作業実施

### マネージャー固有の禁止事項
- ワーカーの専門性を無視したタスク割り当て
- 非現実的な期限設定
- 報告の無視

## 5. エスカレーションルール

### エスカレーションが必要な場合
1. **技術的な重大問題**
   - セキュリティ脆弱性の発見
   - データ損失の可能性
   - システム停止リスク

2. **スケジュール遅延**
   - 期限に間に合わない可能性
   - リソース不足
   - 外部要因による遅延

3. **仕様の不明確さ**
   - 要件の矛盾
   - スコープの不明確さ
   - 意思決定が必要な事項

### エスカレーションフロー
1. ワーカー → 直属のマネージャー
2. マネージャー → メタマネージャー（存在する場合）
3. 緊急時は段階を飛ばして最上位へ

## 6. 作業ディレクトリ構造

```
/sessions/<session-id>/
├── unit/
│   ├── 00/          # メタマネージャー作業領域
│   ├── 10-14/       # デザインユニット作業領域
│   ├── 20-24/       # 開発ユニット作業領域
│   └── 30-34/       # ビジネスユニット作業領域
├── workflows/       # ワークフロー定義
├── shared/          # 共有リソース
└── .session         # セッションメタデータ
```

## 7. コミュニケーション原則

### 明確性
- 曖昧な表現を避ける
- 具体的な数値や期限を明記
- 成果物を明確に定義

### 透明性
- 進捗を定期的に報告
- 問題を早期に共有
- 判断理由を説明

### 協調性
- チームの目標を優先
- 建設的なフィードバック
- 知識の共有

## 8. 例外処理

### メタマネージャー不在時（1ユニットのみの場合）
- ユニットマネージャーが最高責任者として機能
- ワーカーはマネージャーの指示に従う

### エージェント障害時
- 作業を他のエージェントに再割り当て
- マネージャーが調整
- 必要に応じて外部（人間）に支援要請

## 改訂履歴
- 2024-12-31: 初版作成